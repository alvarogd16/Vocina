!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rexrestorabledataplugin=t():e.rexrestorabledataplugin=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=269)}({14:function(e,t,r){"use strict";t.a=function(e){if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]}},269:function(e,t,r){"use strict";r.r(t);var n=r(14);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=Phaser.Data.DataManager,f=Phaser.Utils.Objects.GetValue,h=Phaser.Events.EventEmitter,v=function(e){function t(e,r,n){var i,a,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===r&&(r=new h),a=this,(i=!(l=u(t).call(this,e,r))||"object"!==o(l)&&"function"!=typeof l?s(a):l)._recordEnable=!0,i.resetFromJSON(n),i.events.on("changedata",i.onValueChange,s(i)).on("setdata",function(e,t,r){this.onValueChange(e,t,r,null)},s(i)).on("removedata",function(e,t,r){this.onValueChange(e,t,null,r)},s(i)),i}var r,v,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,c),r=t,(v=[{key:"resetFromJSON",value:function(e){this._version=f(e,"version",0),this._versionAlias=f(e,"versionAlias",""),this._repository=f(e,"repository",[]),this._versionAliases=f(e,"versionAliases",{});var t=f(e,"changeList",{}),r=f(e,"data",void 0);if(r)this._recordEnable=!1,this.set(r),this._recordEnable=!0;else{var n=""!==this._versionAlias?this._versionAlias:this._version;for(var o in this._version=0,this.restore(n),this._recordEnable=!1,t)this.setValue(o,t[o][0]);this._recordEnable=!0}this._changeList=t}},{key:"toJSON",value:function(e){void 0===e&&(e=!1);var t={version:this._version,versionAlias:this._versionAlias,changeList:this._changeList,repository:this._repository,versionAliases:this._versionAliases};return e&&(t.data=this.list),t}},{key:"commit",value:function(e){for(var t in this._repository.length=this._version,this._versionAliases)this._versionAliases[t]>this._version&&delete this._versionAliases[t];return this._repository.push(this._changeList),this._changeList={},this._version++,"string"==typeof e&&(this._versionAlias=e,this._versionAliases[e]=this._version),this}},{key:"restore",value:function(e,t){return void 0===e&&(e=""!==this._versionAlias?this._versionAlias:this._version),void 0===t&&(t=!1),t&&(this.version=0),this.version=e,this}},{key:"reset",value:function(){return this.restore(0),this._repository.length=0,Object(n.a)(this._versionAliases),this}},{key:"onValueChange",value:function(e,t,r,n){this._recordEnable&&(this._changeList.hasOwnProperty(t)?this._changeList[t][0]=r:this._changeList[t]=[r,n])}},{key:"version",get:function(){return this._version},set:function(e){var r;if("string"==typeof e&&(r=e,e=this._versionAliases[e]),"number"==typeof e){if(this._versionAlias=r||"",0===e)return this._recordEnable=!1,a(u(t.prototype),"reset",this).call(this),this._version=0,Object(n.a)(this._changeList),void(this._recordEnable=!0);e=Math.min(e,this._repository.length);var o,i={};for(var s in this._changeList)i[s]=this._changeList[s][1],delete this._changeList[s];if(this._version===e);else if(this._version<e)for(var l=this._version;l<e;l++)for(var s in o=this._repository[l])i[s]=o[s][0];else for(l=this._version-1;l>=e;l--)for(var s in o=this._repository[l])i[s]=o[s][1];for(var s in this._version=e,this._recordEnable=!1,i)null===(e=i[s])?this.removeValue(s):this.setValue(s,e);this._recordEnable=!0}else this._versionAlias=""}},{key:"versionAlias",get:function(){return this._versionAlias}},{key:"lastVersion",get:function(){return this._repository.length}},{key:"versionAliases",get:function(){var e=[];for(var t in this._versionAliases)e.push(t);return e}}])&&i(r.prototype,v),p&&i(r,p),t}();function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),_(this,b(t).call(this,e))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,Phaser.Plugins.BasePlugin),r=t,(n=[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}},{key:"add",value:function(e,t,r){return new v(e,t,r)}}])&&y(r.prototype,n),o&&y(r,o),t}();t.default=g}}).default});